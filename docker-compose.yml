version: "3.6"
services:
  metabase-docker:
    image: metabase/metabase
    restart: always
    ports:
      - 3002:3000
    volumes:
      - ./metabase-data:/metabase-data
    environment:
      JAVA_TOOL_OPTIONS: -Xmx4g
      MB_JETTY_MAXTHREADS: 300
      MB_DB_FILE: /metabase-data/metabase.db
    # The following is a traefik configuration (homolog only)
    # labels:
    #   - traefik.backend=kibana
    #   - traefik.frontend.rule=Host:kibana.guardioes.lappis.rocks
    #   - traefik.docker.network=web
    #   - traefik.port=5601
  painel:
    build: .
    restart: unless-stopped
    networks:
      - internal
    # The following is a traefik configuration (homolog only)
    # labels:
    #   - traefik.backend=myapp
    #   - traefik.frontend.rule=Host:painel.guardioes.lappis.rocks
    #   - traefik.docker.network=web
    #   - traefik.port=8081
    command: npx serve -s build
    ports:
      - "80:80"
    environment:
      - PORT=80
    stdin_open: true
  nginx:
    image: nginx
    restart: unless-stopped
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      - "/etc/timezone:/etc/timezone:ro"
      - "./nginx.conf:/etc/nginx/nginx.conf"
    ports:
      - 8090:80
    # The following is a traefik configuration (homolog only)
    # labels:
    #   - traefik.backend=nginx
    #   - traefik.frontend.rule=Host:kibanaproxy.guardioes.lappis.rocks
    #   - traefik.docker.network=web
    #   - traefik.port=8090

networks:
  internal:
    external: false
